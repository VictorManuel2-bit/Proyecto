<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Opiniones | PanaderÃ­a Artesanal Mabel's</title>

<link rel="stylesheet" href="style.css">

</head>

<body>
<main class="wrap">
<section class="card">

<div class="top">
  <div class="logo">
    <img src="img/Logo1.png" alt="Logo">
  </div>

  <h1>Opiniones de clientes</h1>
  <p>Tu opiniÃ³n nos ayuda a mejorar ğŸ§¡</p>
</div>

<div class="reviews-summary">
  <div id="average">â­ 0.0 / 5</div>
  <div id="total">0 opiniones</div>
</div>

<div class="review-form">

  <div class="stars" id="starContainer">
    <span data-value="1">â˜…</span>
    <span data-value="2">â˜…</span>
    <span data-value="3">â˜…</span>
    <span data-value="4">â˜…</span>
    <span data-value="5">â˜…</span>
  </div>

  <input type="text" id="nameInput" placeholder="Tu nombre" required>

  <textarea id="commentInput" placeholder="EscribÃ­ tu comentario..." required></textarea>

  <a class="btn primary" onclick="submitReview()">
    <div class="left">
      <div class="title">Enviar opiniÃ³n</div>
    </div>
    <div class="icon">â­</div>
  </a>

</div>

<div id="reviewsList"></div>

<div class="menu-actions">

  <a class="btn primary" target="_blank"
     href="https://wa.me/5492204152802">
    <div class="left">
      <div class="title">ğŸ“² Pedir por WhatsApp</div>
      <div class="sub">Te respondemos rÃ¡pido</div>
    </div>
    <div class="icon">ğŸ’¬</div>
  </a>

  <a class="btn" href="index.html">
    <div class="left">
      <div class="title">â¬…ï¸ Volver</div>
      <div class="sub">Regresar al menÃº</div>
    </div>
    <div class="icon">ğŸ </div>
  </a>

</div>

<div class="footer">
  <span class="pill">PanaderÃ­a Artesanal Mabel's ğŸ§¡</span>
</div>

</section>
</main>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "TU_API_KEY",
  authDomain: "TU_AUTH_DOMAIN",
  projectId: "TU_PROJECT_ID",
  storageBucket: "TU_STORAGE_BUCKET",
  messagingSenderId: "TU_MSG_ID",
  appId: "TU_APP_ID"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let selectedRating = 0;

document.querySelectorAll("#starContainer span").forEach(star => {
  star.addEventListener("click", () => {
    selectedRating = Number(star.dataset.value);
    document.querySelectorAll("#starContainer span").forEach(s => s.classList.remove("active"));
    for (let i = 0; i < selectedRating; i++) {
      document.querySelectorAll("#starContainer span")[i].classList.add("active");
    }
  });
});

window.submitReview = async function() {

  const name = document.getElementById("nameInput").value.trim();
  const comment = document.getElementById("commentInput").value.trim();

  if (!name || !comment || selectedRating === 0) {
    alert("CompletÃ¡ nombre, comentario y estrellas");
    return;
  }

  await addDoc(collection(db, "reviews"), {
    name: name,
    comment: comment,
    rating: selectedRating,
    date: new Date()
  });

  document.getElementById("nameInput").value = "";
  document.getElementById("commentInput").value = "";
  selectedRating = 0;
  document.querySelectorAll("#starContainer span").forEach(s => s.classList.remove("active"));

  loadReviews();
}

async function loadReviews() {

  const q = query(collection(db, "reviews"), orderBy("date", "desc"));
  const snapshot = await getDocs(q);

  const list = document.getElementById("reviewsList");
  list.innerHTML = "";

  let total = 0;
  let sum = 0;

  snapshot.forEach(doc => {

    const data = doc.data();
    total++;
    sum += data.rating;

    list.innerHTML += `
      <div class="review-card">
        <div class="review-stars">${"â˜…".repeat(data.rating)}</div>
        <div class="review-name">${data.name}</div>
        <div class="review-text">${data.comment}</div>
      </div>
    `;
  });

  document.getElementById("total").innerText = total + " opiniones";

  if (total > 0) {
    document.getElementById("average").innerText =
      "â­ " + (sum / total).toFixed(1) + " / 5";
  }
}

loadReviews();

</script>

</body>

</html>
